#!/usr/bin/env bash

conda activate enpheeph-scripts-dev

# attribution generation
# not customizable from outside, must be changed each time
# python attribution_generator.py

# IJCNN2023 simulations
# examples
# resnet18 gtsrb, weight index attribution, importance sampling, device 2, seed 1600, 24 hours time limit
# python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 2


# DONE resnet18 gtsrb, activation attribution, importance sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/__activation_seed_1600.pt --random-threshold 0 --injection-type activation --devices 2

# DONE resnet18 gtsrb, weight index attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1

# DONE resnet18 gtsrb, weight index attribution, random sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 3

# DONE resnet18 gtsrb, weight index attribution, random-bit-importance-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1 --bit-random True

# DONE resnet18 gtsrb, weight index attribution, importance-bit-random-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2 --bit-random False

# DONE resnet18 gtsrb, activation attribution, random sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/__activation_seed_1600.pt --random-threshold 1 --injection-type activation --devices 3

# DONE resnet18 cifar10, weight index attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1

# DONE resnet18 cifar10, weight index attribution, random sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2

# DONE resnet18 cifar10, activation attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/__activation_seed_1600.pt --random-threshold 0 --injection-type activation --devices 1

# DONE resnet18 cifar10, activation attribution, random sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/__activation_seed_1600.pt --random-threshold 1 --injection-type activation --devices 2

# DONE vgg11 gtsrb, weight index attribution, importance sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 3

# DONE vgg11 gtsrb, weight index attribution, random sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1

# DONE vgg11 gtsrb, activation attribution, importance sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/__activation_seed_1600.pt --random-threshold 0 --injection-type activation --devices 3

# DONE vgg11 gtsrb, activation attribution, random sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/__activation_seed_1600.pt --random-threshold 1 --injection-type activation --devices 2

# DONE vgg11 cifar10, weight index attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1

# DONE vgg11 cifar10, weight index attribution, random sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2

# DONE vgg11 cifar10, activation attribution, importance sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/__activation_seed_1600.pt --random-threshold 0 --injection-type activation --devices 3

# DONE vgg11 cifar10, activation attribution, random sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/__activation_seed_1600.pt --random-threshold 1 --injection-type activation --devices 1

# after running all of them, on 2023-01-10 19:00 UTC, we found out all the weight injections were running
# in activation configuration, so they were incorrect, and they must be run again

# DONE resnet18 gtsrb, weight index attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1

# DONE resnet18 gtsrb, weight index attribution, random sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 3

# DONE resnet18 gtsrb, weight index attribution, random-bit-importance-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 2 --bit-random

# DONE resnet18 gtsrb, weight index attribution, importance-bit-random-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2 --no-bit-random

# DONE resnet18 cifar10, weight index attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1

# DONE resnet18 cifar10, weight index attribution, random sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 3

# DONE vgg11 gtsrb, weight index attribution, importance sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 3

# DONE vgg11 gtsrb, weight index attribution, random sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1

# DONE vgg11 cifar10, weight index attribution, importance sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1

# DONE vgg11 cifar10, weight index attribution, random sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2


# there was a bug in handling the explicit bit-random flag, so all the simulations
# with it explicitly stated were running with bit-random=True
# however, just to be sure, we are running all of them again

# DONE resnet18 gtsrb, weight index attribution, random-bit-importance-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 2 --bit-random

# DONE resnet18 gtsrb, weight index attribution, importance-bit-random-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2 --no-bit-random

# DONE resnet18 cifar10, weight index attribution, random-bit-importance-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1 --bit-random

# DONE resnet18 cifar10, weight index attribution, importance-bit-random-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance-bit-random-neuron_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1 --bit-weighting exponential

# DONE vgg11 gtsrb, weight index attribution, random-bit-importance-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 2 --bit-weighting random

# DONE vgg11 gtsrb, weight index attribution, importance-bit-random-neuron sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance-bit-random-neuron_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 3 --bit-weighting exponential

# DONE vgg11 cifar10, weight index attribution, random-bit-importance-neuron sampling, device 3, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 3 --bit-weighting random

# DONE vgg11 cifar10, weight index attribution, importance-bit-random-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/importance-bit-random-neuron_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1 --bit-weighting exponential


# we are running the gradient-weighted bits with importance neuron
# this is because the normal exponential weighting is very bad, since the importance
# of the neuron does not change the results by a comma

# DONE resnet18 gtsrb, weight index attribution, gradient-bit-importance-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 2 --bit-weighting gradient

# DONE resnet18 cifar10, weight index attribution, gradient-bit-importance-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-importance-neuron_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1 --bit-weighting gradient

# DONE vgg11 gtsrb, weight index attribution, gradient-bit-importance-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-importance-neuron_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 2 --bit-weighting gradient

# DONE vgg11 cifar10, weight index attribution, gradient-bit-importance-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-importance-neuron_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1 --bit-weighting gradient

# DONE resnet18 gtsrb, weight index attribution, gradient-bit-random-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1 --bit-weighting gradient

# DONE resnet18 cifar10, weight index attribution, gradient-bit-random-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_cifar10/epoch=30-step=38750_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-random-neuron_sampling/resnet18_cifar10/epoch-30-step38750_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_cifar10/epoch-30-step-38750_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1 --bit-weighting gradient

# DONE vgg11 gtsrb, weight index attribution, gradient-bit-random-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_gtsrb/epoch=29-step=19980.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-random-neuron_sampling/vgg11_gtsrb/epoch-29-step19980 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_gtsrb/epoch-29-step-19980/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1 --bit-weighting gradient

# DONE vgg11 cifar10, weight index attribution, gradient-bit-random-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_image_classifier_vgg11_cifar10.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/vgg11_cifar10/epoch=4-step=6250.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-random-neuron_sampling/vgg11_cifar10/epoch-4-step6250 --load-attribution-file results/sparse_results_ijcnn2023/attributions/vgg11_cifar10/epoch-4-step-6250/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 2 --bit-weighting gradient


# we need to run some activation simulation to understand whether
# is the bit importance or the neuron importance the main factor

# DONE resnet18 gtsrb, activation attribution, random-bit-importance-neuron sampling, device 2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/random-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/__activation_seed_1600.pt --random-threshold 0 --injection-type activation --devices 2 --bit-weighting random

# DONE resnet18 gtsrb, activation attribution, exponential-bit-random-neuron sampling, device 1, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/exponential-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/__activation_seed_1600.pt --random-threshold 1 --injection-type activation --devices 1 --bit-weighting exponential

# we need to run multiple seeds

# DONE resnet18 gtsrb, weight index attribution, gradient-bit-importance-neuron sampling, device 1,2,3, seed 1601, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1601 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 0 --injection-type weight --devices 1,2,3 --bit-weighting gradient

# DONE resnet18 gtsrb, weight index attribution, gradient-bit-random-neuron sampling, device 1,2,3, seed 1601, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1601 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/index_weight_seed_1600.pt --random-threshold 1 --injection-type weight --devices 1,2,3 --bit-weighting gradient

# test for approximate gradient value in activation injection, only for gradient bit

# DONE resnet18 gtsrb, activation attribution, gradient-bit-random-neuron sampling, device 1,2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-random-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/__activation_seed_1600.pt --random-threshold 1 --injection-type activation --devices 1,2 --bit-weighting gradient --approximate-activation-gradient-value

# DONE resnet18 gtsrb, activation attribution, gradient-bit-importance-neuron sampling, device 1,2, seed 1600, 24 hours time limit
python parallel_injector_script.py --python-config configs/python/inference_pruned_image_classifier_resnet18_gtsrb.py --checkpoint-file results/sparse_results_ijcnn2023/trained_networks/resnet18_gtsrb/epoch=29-step=19980_0_pruning.ckpt --starting-seed 1600 --number-iterations 10000000 --timeout 86400 --result-folder results/sparse_results_ijcnn2023/gradient-bit-importance-neuron_sampling/resnet18_gtsrb/epoch-29-step19980_0_pruning --load-attribution-file results/sparse_results_ijcnn2023/attributions/resnet18_gtsrb/epoch-29-step-19980_0_pruning/__activation_seed_1600.pt --random-threshold 0 --injection-type activation --devices 1,2 --bit-weighting gradient --approximate-activation-gradient-value
